(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,65953,e=>{"use strict";var a=e.i(43476),l=e.i(71645),t=e.i(18566),s=e.i(41867),i=e.i(19455),n=e.i(93479),r=e.i(46696),d=e.i(71689),c=e.i(7233),o=e.i(88511),m=e.i(27612),u=e.i(86536),x=e.i(77705),h=e.i(75254);let g=(0,h.default)("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]);var j=e.i(30325),p=e.i(73264),f=e.i(46387),v=e.i(71245),y=e.i(70956),C=e.i(3116),b=e.i(87316),w=e.i(17923),N=e.i(30030),S=e.i(48425),F=e.i(42727),T=e.i(81140),_=e.i(69340),D="Toggle",V=l.forwardRef((e,l)=>{let{pressed:t,defaultPressed:s,onPressedChange:i,...n}=e,[r,d]=(0,_.useControllableState)({prop:t,onChange:i,defaultProp:s??!1,caller:D});return(0,a.jsx)(S.Primitive.button,{type:"button","aria-pressed":r,"data-state":r?"on":"off","data-disabled":e.disabled?"":void 0,...n,ref:l,onClick:(0,T.composeEventHandlers)(e.onClick,()=>{e.disabled||d(!r)})})});V.displayName=D;var k=e.i(86318),I="ToggleGroup",[L,B]=(0,N.createContextScope)(I,[F.createRovingFocusGroupScope]),E=(0,F.createRovingFocusGroupScope)(),A=l.default.forwardRef((e,l)=>{let{type:t,...s}=e;if("single"===t)return(0,a.jsx)(G,{...s,ref:l});if("multiple"===t)return(0,a.jsx)(q,{...s,ref:l});throw Error(`Missing prop \`type\` expected on \`${I}\``)});A.displayName=I;var[R,O]=L(I),G=l.default.forwardRef((e,t)=>{let{value:s,defaultValue:i,onValueChange:n=()=>{},...r}=e,[d,c]=(0,_.useControllableState)({prop:s,defaultProp:i??"",onChange:n,caller:I});return(0,a.jsx)(R,{scope:e.__scopeToggleGroup,type:"single",value:l.default.useMemo(()=>d?[d]:[],[d]),onItemActivate:c,onItemDeactivate:l.default.useCallback(()=>c(""),[c]),children:(0,a.jsx)(H,{...r,ref:t})})}),q=l.default.forwardRef((e,t)=>{let{value:s,defaultValue:i,onValueChange:n=()=>{},...r}=e,[d,c]=(0,_.useControllableState)({prop:s,defaultProp:i??[],onChange:n,caller:I}),o=l.default.useCallback(e=>c((a=[])=>[...a,e]),[c]),m=l.default.useCallback(e=>c((a=[])=>a.filter(a=>a!==e)),[c]);return(0,a.jsx)(R,{scope:e.__scopeToggleGroup,type:"multiple",value:d,onItemActivate:o,onItemDeactivate:m,children:(0,a.jsx)(H,{...r,ref:t})})});A.displayName=I;var[P,z]=L(I),H=l.default.forwardRef((e,l)=>{let{__scopeToggleGroup:t,disabled:s=!1,rovingFocus:i=!0,orientation:n,dir:r,loop:d=!0,...c}=e,o=E(t),m=(0,k.useDirection)(r),u={role:"group",dir:m,...c};return(0,a.jsx)(P,{scope:t,rovingFocus:i,disabled:s,children:i?(0,a.jsx)(F.Root,{asChild:!0,...o,orientation:n,dir:m,loop:d,children:(0,a.jsx)(S.Primitive.div,{...u,ref:l})}):(0,a.jsx)(S.Primitive.div,{...u,ref:l})})}),U="ToggleGroupItem",K=l.default.forwardRef((e,t)=>{let s=O(U,e.__scopeToggleGroup),i=z(U,e.__scopeToggleGroup),n=E(e.__scopeToggleGroup),r=s.value.includes(e.value),d=i.disabled||e.disabled,c={...e,pressed:r,disabled:d},o=l.default.useRef(null);return i.rovingFocus?(0,a.jsx)(F.Item,{asChild:!0,...n,focusable:!d,active:r,ref:o,children:(0,a.jsx)($,{...c,ref:t})}):(0,a.jsx)($,{...c,ref:t})});K.displayName=U;var $=l.default.forwardRef((e,l)=>{let{__scopeToggleGroup:t,value:s,...i}=e,n=O(U,t),r={role:"radio","aria-checked":e.pressed,"aria-pressed":void 0},d="single"===n.type?r:void 0;return(0,a.jsx)(V,{...d,...i,ref:l,onPressedChange:e=>{e?n.onItemActivate(s):n.onItemDeactivate(s)}})}),M=e.i(75157);let Y=(0,e.i(25913).cva)("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"},size:{default:"h-10 px-3",sm:"h-9 px-2.5",lg:"h-11 px-5"}},defaultVariants:{variant:"default",size:"default"}});l.forwardRef(({className:e,variant:l,size:t,...s},i)=>(0,a.jsx)(V,{ref:i,className:(0,M.cn)(Y({variant:l,size:t,className:e})),...s})).displayName=V.displayName;let J=l.createContext({size:"default",variant:"default"}),Q=l.forwardRef(({className:e,variant:l,size:t,children:s,...i},n)=>(0,a.jsx)(A,{ref:n,className:(0,M.cn)("flex items-center justify-center gap-1",e),...i,children:(0,a.jsx)(J.Provider,{value:{variant:l,size:t},children:s})}));Q.displayName=A.displayName;let W=l.forwardRef(({className:e,children:t,variant:s,size:i,...n},r)=>{let d=l.useContext(J);return(0,a.jsx)(K,{ref:r,className:(0,M.cn)(Y({variant:d.variant||s,size:d.size||i}),e),...n,children:t})});W.displayName=K.displayName;var X=e.i(50630),Z=e.i(15288),ee=e.i(76639),ea=e.i(10204),el=e.i(24687),et=e.i(99375),es=e.i(62050),ei=e.i(23182);let en=({open:e,onOpenChange:t,entityId:d,fields:c,record:o,onSuccess:m})=>{let[u,x]=(0,l.useState)(!1),[h,g]=(0,l.useState)({}),[j,p]=(0,l.useState)(!1);(0,l.useEffect)(()=>{if(o)g(o.data),p(o.is_published??!1);else{let e={};c.forEach(a=>{e[a.name]=a.default_value||""}),g(e),p(!1)}},[o,c,e]);let f=async e=>{e.preventDefault(),x(!0);try{let{data:{user:e}}=await s.supabase.auth.getUser();if(!e)return void r.toast.error("You must be logged in");for(let e of c)if(e.is_required&&(!h[e.name]||""===h[e.name])){r.toast.error(`${e.display_name} is required`),x(!1);return}if(o){let{error:e}=await s.supabase.from("entity_records").update({data:h,is_published:j}).eq("id",o.id);if(e)throw e;r.toast.success("Record updated successfully")}else{let{data:a}=await s.supabase.from("entities").select("id").eq("id",d).single();if(!a){let a=await (0,ei.getEntity)(d);if(a){let{error:l}=await s.supabase.from("entities").insert({id:d,name:a.name,display_name:a.display_name,description:a.description,user_id:e.id});l&&console.error("Failed to sync entity to Supabase:",l)}}let{error:l}=await s.supabase.from("entity_records").insert({entity_id:d,user_id:e.id,data:h,is_published:j});if(l)throw l;r.toast.success("Record created successfully")}t(!1),m()}catch(e){console.error(e),r.toast.error(e.message||"An error occurred")}finally{x(!1)}};return(0,a.jsx)(ee.Dialog,{open:e,onOpenChange:t,children:(0,a.jsxs)(ee.DialogContent,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[(0,a.jsxs)(ee.DialogHeader,{children:[(0,a.jsx)(ee.DialogTitle,{children:o?"Edit Record":"Create New Record"}),(0,a.jsx)(ee.DialogDescription,{children:o?"Update the record details below":"Fill in the details for the new record"})]}),(0,a.jsxs)("form",{onSubmit:f,children:[(0,a.jsxs)("div",{className:"space-y-4 py-4",children:[c.map(e=>(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(ea.Label,{htmlFor:e.name,children:[e.display_name,e.is_required&&(0,a.jsx)("span",{className:"text-destructive ml-1",children:"*"})]}),(e=>{let l=h[e.name]||"";switch(e.field_type){case es.E_FieldDataType.TextArea:return(0,a.jsx)(el.Textarea,{id:e.name,value:l,onChange:a=>g({...h,[e.name]:a.target.value}),required:e.is_required,rows:4});case es.E_FieldDataType.Boolean:return(0,a.jsx)(et.Switch,{checked:"true"===l||!0===l,onCheckedChange:a=>g({...h,[e.name]:a})});case es.E_FieldDataType.Interger:return(0,a.jsx)(n.Input,{id:e.name,type:"number",value:l,onChange:a=>g({...h,[e.name]:a.target.value}),required:e.is_required});case es.E_FieldDataType.Date:return(0,a.jsx)(n.Input,{id:e.name,type:"date",value:l,onChange:a=>g({...h,[e.name]:a.target.value}),required:e.is_required});default:return(0,a.jsx)(n.Input,{id:e.name,type:e.field_type===es.E_FieldDataType.Image?"url":"text",value:l,onChange:a=>g({...h,[e.name]:a.target.value}),required:e.is_required,placeholder:e.field_type===es.E_FieldDataType.Image?"https://...":""})}})(e)]},e.name)),(0,a.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t",children:[(0,a.jsx)(ea.Label,{children:"Published"}),(0,a.jsx)(et.Switch,{checked:j,onCheckedChange:p})]})]}),(0,a.jsxs)(ee.DialogFooter,{children:[(0,a.jsx)(i.Button,{type:"button",variant:"outline",onClick:()=>t(!1),children:"Cancel"}),(0,a.jsx)(i.Button,{type:"submit",disabled:u,children:u?"Saving...":o?"Update":"Create"})]})]})]})})};var er=e.i(67489),ed=e.i(80376),ec=e.i(57428),eo=e.i(77572);let em=(0,h.default)("SlidersHorizontal",[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]]);var eu=e.i(99602),ex=e.i(56909),eh=e.i(54449);let eg=({entityId:e,fields:t,viewOptions:d,onViewOptionsChange:c,currentViewName:o,currentViewId:m,onViewSaved:u})=>{let[x,h]=(0,l.useState)(!1),[g,N]=(0,l.useState)(""),[S,F]=(0,l.useState)(!1),T=async()=>{let a=S?g:g||o;if(!a?.trim())return void r.toast.error("Please enter a view name");let{data:{user:l}}=await s.supabase.auth.getUser();if(!l)return void r.toast.error("You must be logged in to save views");if(!S&&m){let{error:e}=await s.supabase.from("entity_views").update({name:a,view_config:d}).eq("id",m);e?(r.toast.error("Failed to update view"),console.error(e)):(r.toast.success("View updated successfully"),N(""),F(!1),h(!1),u?.())}else{let{error:t}=await s.supabase.from("entity_views").insert([{entity_id:e,name:a,view_config:d,is_default:!1,user_id:l.id}]);t?(r.toast.error("Failed to save view"),console.error(t)):(r.toast.success("View saved successfully"),N(""),F(!1),h(!1),u?.())}};return(0,a.jsxs)(ed.Sheet,{open:x,onOpenChange:h,children:[(0,a.jsx)(ed.SheetTrigger,{asChild:!0,children:(0,a.jsxs)(i.Button,{variant:"outline",size:"sm",children:[(0,a.jsx)(em,{className:"h-4 w-4 mr-2"}),"View Options"]})}),(0,a.jsxs)(ed.SheetContent,{children:[(0,a.jsx)(ed.SheetHeader,{children:(0,a.jsx)(ed.SheetTitle,{children:"View Options"})}),(0,a.jsxs)(eo.Tabs,{value:d.viewType||"table",onValueChange:e=>c({...d,viewType:e}),className:"mt-6",children:[(0,a.jsxs)(eo.TabsList,{className:"grid grid-cols-4 mb-4",children:[(0,a.jsxs)(eo.TabsTrigger,{value:"table",className:"text-xs",children:[(0,a.jsx)(j.Table2,{className:"h-3 w-3 mr-1"}),"Table"]}),(0,a.jsxs)(eo.TabsTrigger,{value:"card",className:"text-xs",children:[(0,a.jsx)(p.LayoutGrid,{className:"h-3 w-3 mr-1"}),"Card"]}),(0,a.jsxs)(eo.TabsTrigger,{value:"kanban",className:"text-xs",children:[(0,a.jsx)(f.Columns3,{className:"h-3 w-3 mr-1"}),"Kanban"]}),(0,a.jsxs)(eo.TabsTrigger,{value:"gallery",className:"text-xs",children:[(0,a.jsx)(v.Images,{className:"h-3 w-3 mr-1"}),"Gallery"]})]}),(0,a.jsxs)(eo.TabsList,{className:"grid grid-cols-4 mb-6",children:[(0,a.jsxs)(eo.TabsTrigger,{value:"list",className:"text-xs",children:[(0,a.jsx)(y.List,{className:"h-3 w-3 mr-1"}),"List"]}),(0,a.jsxs)(eo.TabsTrigger,{value:"timeline",className:"text-xs",children:[(0,a.jsx)(C.Clock,{className:"h-3 w-3 mr-1"}),"Timeline"]}),(0,a.jsxs)(eo.TabsTrigger,{value:"calendar",className:"text-xs",children:[(0,a.jsx)(b.Calendar,{className:"h-3 w-3 mr-1"}),"Calendar"]}),(0,a.jsxs)(eo.TabsTrigger,{value:"gantt",className:"text-xs",children:[(0,a.jsx)(w.BarChart3,{className:"h-3 w-3 mr-1"}),"Gantt"]})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)(eo.TabsContent,{value:"table",className:"space-y-6 mt-0",children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)(ea.Label,{className:"text-base font-semibold",children:"Visible Columns"}),(0,a.jsx)("div",{className:"space-y-2",children:t.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(ec.Checkbox,{id:`col-${e.name}`,checked:d.visibleColumns.includes(e.name),onCheckedChange:a=>{var l;let t;return l=e.name,t=a?[...d.visibleColumns,l]:d.visibleColumns.filter(e=>e!==l),void c({...d,visibleColumns:t})}}),(0,a.jsx)(ea.Label,{htmlFor:`col-${e.name}`,className:"font-normal cursor-pointer",children:e.display_name})]},e.name))})]})}),(0,a.jsx)(eo.TabsContent,{value:"card",className:"space-y-6 mt-0",children:(0,a.jsx)(eh.CardLayoutEditor,{fields:t,layout:d.cardLayout||{titleField:t[0]?.name||"",displayFields:[]},onChange:e=>c({...d,cardLayout:e})})}),(0,a.jsxs)(eo.TabsContent,{value:"kanban",className:"space-y-6 mt-0",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(ea.Label,{className:"text-sm font-medium",children:"Group By Field *"}),(0,a.jsxs)(er.Select,{value:d.kanbanConfig?.groupByField||"none",onValueChange:e=>c({...d,kanbanConfig:{groupByField:e,cardLayout:d.kanbanConfig?.cardLayout||{titleField:t[0]?.name||"",displayFields:[]}}}),children:[(0,a.jsx)(er.SelectTrigger,{className:"mt-1",children:(0,a.jsx)(er.SelectValue,{placeholder:"Select field to group by"})}),(0,a.jsxs)(er.SelectContent,{children:[(0,a.jsx)(er.SelectItem,{value:"none",children:"None"}),t.filter(e=>e.field_type===es.E_FieldDataType.String).map(e=>(0,a.jsx)(er.SelectItem,{value:e.name,children:e.display_name},e.name))]})]})]}),(0,a.jsxs)("div",{className:"pt-4 border-t",children:[(0,a.jsx)(ea.Label,{className:"text-base font-semibold mb-4 block",children:"Card Configuration"}),(0,a.jsx)(eh.CardLayoutEditor,{fields:t,layout:d.kanbanConfig?.cardLayout||{titleField:t[0]?.name||"",displayFields:[]},onChange:e=>c({...d,kanbanConfig:{groupByField:d.kanbanConfig?.groupByField||"",cardLayout:e}}),showImageField:!1})]})]}),(0,a.jsxs)(eo.TabsContent,{value:"gallery",className:"space-y-6 mt-0",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(ea.Label,{className:"text-sm font-medium",children:"Image Field *"}),(0,a.jsxs)(er.Select,{value:d.galleryConfig?.imageField||"none",onValueChange:e=>c({...d,galleryConfig:{imageField:e,titleField:d.galleryConfig?.titleField||t[0]?.name||""}}),children:[(0,a.jsx)(er.SelectTrigger,{className:"mt-1",children:(0,a.jsx)(er.SelectValue,{placeholder:"Select image field"})}),(0,a.jsxs)(er.SelectContent,{children:[(0,a.jsx)(er.SelectItem,{value:"none",children:"None"}),t.filter(e=>e.field_type===es.E_FieldDataType.Image).map(e=>(0,a.jsx)(er.SelectItem,{value:e.name,children:e.display_name},e.name))]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(ea.Label,{className:"text-sm font-medium",children:"Title Field *"}),(0,a.jsxs)(er.Select,{value:d.galleryConfig?.titleField||t[0]?.name,onValueChange:e=>c({...d,galleryConfig:{imageField:d.galleryConfig?.imageField||"",titleField:e}}),children:[(0,a.jsx)(er.SelectTrigger,{className:"mt-1",children:(0,a.jsx)(er.SelectValue,{placeholder:"Select title field"})}),(0,a.jsx)(er.SelectContent,{children:t.map(e=>(0,a.jsx)(er.SelectItem,{value:e.name,children:e.display_name},e.name))})]})]})]}),(0,a.jsx)(eo.TabsContent,{value:"list",className:"space-y-6 mt-0",children:(0,a.jsx)(eh.CardLayoutEditor,{fields:t,layout:d.listConfig||{titleField:t[0]?.name||"",displayFields:[]},onChange:e=>c({...d,listConfig:e}),showImageField:!1})}),(0,a.jsxs)(eo.TabsContent,{value:"timeline",className:"space-y-6 mt-0",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(ea.Label,{className:"text-sm font-medium",children:"Date Field *"}),(0,a.jsxs)(er.Select,{value:d.timelineConfig?.dateField||"none",onValueChange:e=>c({...d,timelineConfig:{dateField:e,titleField:d.timelineConfig?.titleField||t[0]?.name||""}}),children:[(0,a.jsx)(er.SelectTrigger,{className:"mt-1",children:(0,a.jsx)(er.SelectValue,{placeholder:"Select date field"})}),(0,a.jsxs)(er.SelectContent,{children:[(0,a.jsx)(er.SelectItem,{value:"none",children:"None"}),t.filter(e=>e.field_type===es.E_FieldDataType.Date).map(e=>(0,a.jsx)(er.SelectItem,{value:e.name,children:e.display_name},e.name))]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(ea.Label,{className:"text-sm font-medium",children:"Title Field *"}),(0,a.jsxs)(er.Select,{value:d.timelineConfig?.titleField||t[0]?.name,onValueChange:e=>c({...d,timelineConfig:{dateField:d.timelineConfig?.dateField||"",titleField:e}}),children:[(0,a.jsx)(er.SelectTrigger,{className:"mt-1",children:(0,a.jsx)(er.SelectValue,{placeholder:"Select title field"})}),(0,a.jsx)(er.SelectContent,{children:t.map(e=>(0,a.jsx)(er.SelectItem,{value:e.name,children:e.display_name},e.name))})]})]})]}),(0,a.jsxs)(eo.TabsContent,{value:"calendar",className:"space-y-6 mt-0",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(ea.Label,{className:"text-sm font-medium",children:"Date Field *"}),(0,a.jsxs)(er.Select,{value:d.calendarConfig?.dateField||"none",onValueChange:e=>c({...d,calendarConfig:{dateField:e,titleField:d.calendarConfig?.titleField||t[0]?.name||""}}),children:[(0,a.jsx)(er.SelectTrigger,{className:"mt-1",children:(0,a.jsx)(er.SelectValue,{placeholder:"Select date field"})}),(0,a.jsxs)(er.SelectContent,{children:[(0,a.jsx)(er.SelectItem,{value:"none",children:"None"}),t.filter(e=>e.field_type===es.E_FieldDataType.Date).map(e=>(0,a.jsx)(er.SelectItem,{value:e.name,children:e.display_name},e.name))]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(ea.Label,{className:"text-sm font-medium",children:"Title Field *"}),(0,a.jsxs)(er.Select,{value:d.calendarConfig?.titleField||t[0]?.name,onValueChange:e=>c({...d,calendarConfig:{dateField:d.calendarConfig?.dateField||"",titleField:e}}),children:[(0,a.jsx)(er.SelectTrigger,{className:"mt-1",children:(0,a.jsx)(er.SelectValue,{placeholder:"Select title field"})}),(0,a.jsx)(er.SelectContent,{children:t.map(e=>(0,a.jsx)(er.SelectItem,{value:e.name,children:e.display_name},e.name))})]})]})]}),(0,a.jsxs)(eo.TabsContent,{value:"gantt",className:"space-y-6 mt-0",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(ea.Label,{className:"text-sm font-medium",children:"Start Date Field *"}),(0,a.jsxs)(er.Select,{value:d.ganttConfig?.startDateField||"none",onValueChange:e=>c({...d,ganttConfig:{startDateField:e,endDateField:d.ganttConfig?.endDateField||"",titleField:d.ganttConfig?.titleField||t[0]?.name||""}}),children:[(0,a.jsx)(er.SelectTrigger,{className:"mt-1",children:(0,a.jsx)(er.SelectValue,{placeholder:"Select start date field"})}),(0,a.jsxs)(er.SelectContent,{children:[(0,a.jsx)(er.SelectItem,{value:"none",children:"None"}),t.filter(e=>e.field_type===es.E_FieldDataType.Date).map(e=>(0,a.jsx)(er.SelectItem,{value:e.name,children:e.display_name},e.name))]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(ea.Label,{className:"text-sm font-medium",children:"End Date Field *"}),(0,a.jsxs)(er.Select,{value:d.ganttConfig?.endDateField||"none",onValueChange:e=>c({...d,ganttConfig:{startDateField:d.ganttConfig?.startDateField||"",endDateField:e,titleField:d.ganttConfig?.titleField||t[0]?.name||""}}),children:[(0,a.jsx)(er.SelectTrigger,{className:"mt-1",children:(0,a.jsx)(er.SelectValue,{placeholder:"Select end date field"})}),(0,a.jsxs)(er.SelectContent,{children:[(0,a.jsx)(er.SelectItem,{value:"none",children:"None"}),t.filter(e=>e.field_type===es.E_FieldDataType.Date).map(e=>(0,a.jsx)(er.SelectItem,{value:e.name,children:e.display_name},e.name))]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(ea.Label,{className:"text-sm font-medium",children:"Title Field *"}),(0,a.jsxs)(er.Select,{value:d.ganttConfig?.titleField||t[0]?.name,onValueChange:e=>c({...d,ganttConfig:{startDateField:d.ganttConfig?.startDateField||"",endDateField:d.ganttConfig?.endDateField||"",titleField:e}}),children:[(0,a.jsx)(er.SelectTrigger,{className:"mt-1",children:(0,a.jsx)(er.SelectValue,{placeholder:"Select title field"})}),(0,a.jsx)(er.SelectContent,{children:t.map(e=>(0,a.jsx)(er.SelectItem,{value:e.name,children:e.display_name},e.name))})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(ea.Label,{className:"text-sm font-medium",children:"Group By (Optional)"}),(0,a.jsxs)(er.Select,{value:d.ganttConfig?.groupByField||"none",onValueChange:e=>c({...d,ganttConfig:{...d.ganttConfig,groupByField:"none"===e?void 0:e}}),children:[(0,a.jsx)(er.SelectTrigger,{className:"mt-1",children:(0,a.jsx)(er.SelectValue,{placeholder:"None"})}),(0,a.jsxs)(er.SelectContent,{children:[(0,a.jsx)(er.SelectItem,{value:"none",children:"None"}),t.filter(e=>e.field_type===es.E_FieldDataType.String).map(e=>(0,a.jsx)(er.SelectItem,{value:e.name,children:e.display_name},e.name))]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(ea.Label,{className:"text-sm font-medium",children:"Color By (Optional)"}),(0,a.jsxs)(er.Select,{value:d.ganttConfig?.colorByField||"none",onValueChange:e=>c({...d,ganttConfig:{...d.ganttConfig,colorByField:"none"===e?void 0:e}}),children:[(0,a.jsx)(er.SelectTrigger,{className:"mt-1",children:(0,a.jsx)(er.SelectValue,{placeholder:"None"})}),(0,a.jsxs)(er.SelectContent,{children:[(0,a.jsx)(er.SelectItem,{value:"none",children:"None"}),t.map(e=>(0,a.jsx)(er.SelectItem,{value:e.name,children:e.display_name},e.name))]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(ea.Label,{className:"text-sm font-medium",children:"Dependencies Field (Optional)"}),(0,a.jsxs)(er.Select,{value:d.ganttConfig?.dependenciesField||"none",onValueChange:e=>c({...d,ganttConfig:{...d.ganttConfig,dependenciesField:"none"===e?void 0:e}}),children:[(0,a.jsx)(er.SelectTrigger,{className:"mt-1",children:(0,a.jsx)(er.SelectValue,{placeholder:"None"})}),(0,a.jsxs)(er.SelectContent,{children:[(0,a.jsx)(er.SelectItem,{value:"none",children:"None"}),t.map(e=>(0,a.jsx)(er.SelectItem,{value:e.name,children:e.display_name},e.name))]})]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Field containing comma-separated IDs or JSON array of dependent task IDs"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(ea.Label,{className:"text-sm font-medium",children:"Progress Field (Optional)"}),(0,a.jsxs)(er.Select,{value:d.ganttConfig?.progressField||"none",onValueChange:e=>c({...d,ganttConfig:{...d.ganttConfig,progressField:"none"===e?void 0:e}}),children:[(0,a.jsx)(er.SelectTrigger,{className:"mt-1",children:(0,a.jsx)(er.SelectValue,{placeholder:"None"})}),(0,a.jsxs)(er.SelectContent,{children:[(0,a.jsx)(er.SelectItem,{value:"none",children:"None"}),t.filter(e=>e.field_type===es.E_FieldDataType.Interger).map(e=>(0,a.jsx)(er.SelectItem,{value:e.name,children:e.display_name},e.name))]})]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Field containing a number between 0-100 representing completion percentage"})]})]}),(0,a.jsxs)("div",{className:"space-y-3 pt-6 border-t",children:[(0,a.jsx)(ea.Label,{className:"text-base font-semibold",children:"Sort By"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(er.Select,{value:d.sortField||"none",onValueChange:e=>{c({...d,sortField:"none"===e?null:e})},children:[(0,a.jsx)(er.SelectTrigger,{className:"flex-1",children:(0,a.jsx)(er.SelectValue,{placeholder:"Select field to sort"})}),(0,a.jsxs)(er.SelectContent,{children:[(0,a.jsx)(er.SelectItem,{value:"none",children:"None"}),t.map(e=>(0,a.jsx)(er.SelectItem,{value:e.name,children:e.display_name},e.name))]})]}),d.sortField&&(0,a.jsx)(i.Button,{variant:"outline",size:"sm",onClick:()=>{c({...d,sortOrder:"asc"===d.sortOrder?"desc":"asc"})},className:"px-3",title:"asc"===d.sortOrder?"Ascending":"Descending",children:(0,a.jsx)(eu.ArrowUpDown,{className:"h-4 w-4"})})]})]})]}),(0,a.jsxs)("div",{className:"space-y-3 pt-6 border-t",children:[(0,a.jsx)(ea.Label,{className:"text-base font-semibold",children:"Save View"}),o&&(0,a.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Current View: ",(0,a.jsx)("span",{className:"font-medium",children:o})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[o&&(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(ec.Checkbox,{id:"save-as-new",checked:S,onCheckedChange:e=>F(e)}),(0,a.jsx)(ea.Label,{htmlFor:"save-as-new",className:"font-normal cursor-pointer",children:"Save as new view"})]}),(S||!o)&&(0,a.jsx)(n.Input,{placeholder:"Enter view name...",value:g,onChange:e=>N(e.target.value)}),(0,a.jsxs)(i.Button,{onClick:T,className:"w-full",children:[(0,a.jsx)(ex.Save,{className:"h-4 w-4 mr-2"}),S?"Save as New":o?"Update View":"Save View"]})]})]})]})]})]})};var ej=e.i(68499);let ep=(0,l.forwardRef)(({entityId:e,currentView:t,onViewLoad:d,onViewNameChange:c,onViewIdChange:o},u)=>{let[x,h]=(0,l.useState)([]),[g,N]=(0,l.useState)(null),[S,F]=(0,l.useState)(!1),[T,_]=(0,l.useState)(""),[D,V]=(0,l.useState)(null),[k,I]=(0,l.useState)(!1),L=async()=>{let{data:{user:a}}=await s.supabase.auth.getUser();if(!a)return;let{data:l,error:t}=await s.supabase.from("entity_views").select("*").eq("entity_id",e).order("created_at");if(t)console.error("Error loading views:",t);else if(h((l||[]).map(e=>({...e,is_default:!!e.is_default}))),!k){let e=l?.find(e=>e.is_default);e&&(N(e.id),d(e.view_config),c?.(e.name),o?.(e.id),I(!0))}};(0,l.useEffect)(()=>{L()},[e]),(0,l.useImperativeHandle)(u,()=>({refreshViews:L}));let B=async()=>{if(!T.trim())return void r.toast.error("Please enter a view name");let{data:{user:a}}=await s.supabase.auth.getUser();if(!a)return;let{error:l}=await s.supabase.from("entity_views").insert([{entity_id:e,user_id:a.id,name:T,view_config:t}]);l?(r.toast.error("Failed to save view"),console.error(l)):(r.toast.success("View saved successfully"),_(""),F(!1),L())},E=async()=>{if(!D)return;let{error:e}=await s.supabase.from("entity_views").delete().eq("id",D);e?(r.toast.error("Failed to delete view"),console.error(e)):(r.toast.success("View deleted"),g===D&&N(null),L()),V(null)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(er.Select,{value:g||"default",onValueChange:e=>{if("default"===e){N(null),c?.("Default View"),o?.(null);return}let a=x.find(a=>a.id===e);a&&(N(e),d(a.view_config),c?.(a.name),o?.(e))},children:[(0,a.jsx)(er.SelectTrigger,{className:"w-48",children:(0,a.jsx)(er.SelectValue,{placeholder:"Select view"})}),(0,a.jsxs)(er.SelectContent,{className:"bg-popover z-50",children:[(0,a.jsx)(er.SelectItem,{value:"default",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(j.Table2,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Default View"})]})}),x.map(e=>(0,a.jsx)(er.SelectItem,{value:e.id,children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(e=>{switch(e){case"table":default:return(0,a.jsx)(j.Table2,{className:"h-4 w-4"});case"card":return(0,a.jsx)(p.LayoutGrid,{className:"h-4 w-4"});case"kanban":return(0,a.jsx)(f.Columns3,{className:"h-4 w-4"});case"gallery":return(0,a.jsx)(v.Images,{className:"h-4 w-4"});case"list":return(0,a.jsx)(y.List,{className:"h-4 w-4"});case"timeline":return(0,a.jsx)(C.Clock,{className:"h-4 w-4"});case"calendar":return(0,a.jsx)(b.Calendar,{className:"h-4 w-4"});case"gantt":return(0,a.jsx)(w.BarChart3,{className:"h-4 w-4"})}})(e.view_config?.viewType),(0,a.jsx)("span",{children:e.name})]})},e.id))]})]}),(0,a.jsxs)(i.Button,{variant:"outline",size:"sm",onClick:()=>F(!0),children:[(0,a.jsx)(ex.Save,{className:"h-4 w-4 mr-2"}),"Save View"]}),g&&"default"!==g&&(0,a.jsx)(i.Button,{variant:"ghost",size:"sm",onClick:()=>V(g),children:(0,a.jsx)(m.Trash2,{className:"h-4 w-4"})})]}),(0,a.jsx)(ee.Dialog,{open:S,onOpenChange:F,children:(0,a.jsxs)(ee.DialogContent,{children:[(0,a.jsxs)(ee.DialogHeader,{children:[(0,a.jsx)(ee.DialogTitle,{children:"Save View"}),(0,a.jsx)(ee.DialogDescription,{children:"Give this view a name to save your current column selection, sorting, and filters."})]}),(0,a.jsx)(n.Input,{placeholder:"View name",value:T,onChange:e=>_(e.target.value),onKeyDown:e=>"Enter"===e.key&&B()}),(0,a.jsxs)(ee.DialogFooter,{children:[(0,a.jsx)(i.Button,{variant:"outline",onClick:()=>F(!1),children:"Cancel"}),(0,a.jsx)(i.Button,{onClick:B,children:"Save"})]})]})}),(0,a.jsx)(ej.AlertDialog,{open:!!D,onOpenChange:()=>V(null),children:(0,a.jsxs)(ej.AlertDialogContent,{children:[(0,a.jsxs)(ej.AlertDialogHeader,{children:[(0,a.jsx)(ej.AlertDialogTitle,{children:"Delete View"}),(0,a.jsx)(ej.AlertDialogDescription,{children:"Are you sure you want to delete this saved view? This action cannot be undone."})]}),(0,a.jsxs)(ej.AlertDialogFooter,{children:[(0,a.jsx)(ej.AlertDialogCancel,{children:"Cancel"}),(0,a.jsx)(ej.AlertDialogAction,{onClick:E,children:"Delete"})]})]})})]})});ep.displayName="ViewSelector";var ef=e.i(56392),ev=e.i(66479),ey=e.i(47821),eC=e.i(74339),eb=e.i(87728),ew=e.i(66255),eN=e.i(38776),eS=e.i(84774),eF=e.i(87486);e.s(["default",0,()=>{let e=(0,t.useRouter)(),h=(0,t.useParams)().entityId,[N,S]=(0,l.useState)(null),[F,T]=(0,l.useState)([]),[_,D]=(0,l.useState)([]),[V,k]=(0,l.useState)(!0),[I,L]=(0,l.useState)(""),[B,E]=(0,l.useState)(!1),[A,R]=(0,l.useState)(null),[O,G]=(0,l.useState)(null),[q,P]=(0,l.useState)({visibleColumns:[],sortField:null,sortOrder:"asc",filters:[]}),[z,H]=(0,l.useState)("Default View"),[U,K]=(0,l.useState)(null),$=(0,l.useRef)(null);(0,l.useEffect)(()=>{M()},[h]);let M=async()=>{if(!h)return;k(!0);let e=await (0,ei.getEntity)(h),a=await (0,ei.getFields)(h),{data:l,error:t}=await s.supabase.from("entity_records").select("*").eq("entity_id",h).order("created_at",{ascending:!1});if(!e||t)r.toast.error("Failed to load data"),console.error({recordsError:t});else{S(e);let t=a||[];T(t),D(l||[]),0===q.visibleColumns.length&&t.length>0&&P(e=>({...e,visibleColumns:t.map(e=>e.id)}))}k(!1)},Y=async()=>{if(!O)return;let{error:e}=await s.supabase.from("entity_records").delete().eq("id",O);e?(r.toast.error("Failed to delete record"),console.error(e)):(r.toast.success("Record deleted"),M()),G(null)},J=async(e,a)=>{let{error:l}=await s.supabase.from("entity_records").update({is_published:!a}).eq("id",e);l?(r.toast.error("Failed to update record"),console.error(l)):(r.toast.success(`Record ${!a?"published":"unpublished"}`),M())},ee=async a=>{e.push(`/admin/entities/${h}/editor`)},ea=[..._.filter(e=>!I||Object.values(e.data).some(e=>String(e).toLowerCase().includes(I.toLowerCase())))].sort((e,a)=>{if(!q.sortField)return 0;let l=e.data[q.sortField],t=a.data[q.sortField];if(l===t)return 0;let s=l>t?1:-1;return"asc"===q.sortOrder?s:-s}),el=F.filter(e=>q.visibleColumns.includes(e.id));return V?(0,a.jsx)(X.AdminLayout,{children:(0,a.jsx)("div",{className:"p-8",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto text-center py-12 text-muted-foreground",children:"Loading records..."})})}):N?(0,a.jsxs)(X.AdminLayout,{children:[(0,a.jsx)("div",{className:"p-8",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 mb-8",children:[(0,a.jsx)(i.Button,{variant:"outline",size:"icon",onClick:()=>e.push("/admin/entities"),children:(0,a.jsx)(d.ArrowLeft,{className:"h-4 w-4"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:N.display_name}),(0,a.jsx)("p",{className:"text-muted-foreground mt-1",children:"Manage entity records"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(eg,{entityId:h,fields:F,viewOptions:q,onViewOptionsChange:P,currentViewName:z,currentViewId:U,onViewSaved:()=>$.current?.refreshViews()}),(0,a.jsxs)(i.Button,{variant:"outline",size:"sm",onClick:()=>ee(h),children:[(0,a.jsx)(g,{className:"h-4 w-4 mr-2"}),"Edit Fields"]}),(0,a.jsxs)(i.Button,{onClick:()=>{R(null),E(!0)},children:[(0,a.jsx)(c.Plus,{className:"h-4 w-4 mr-2"}),"Add Record"]})]})]}),(0,a.jsxs)(Z.Card,{className:"p-6",children:[(0,a.jsxs)("div",{className:"mb-4 space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-wrap gap-4 items-center",children:[(0,a.jsx)(ep,{ref:$,entityId:h,currentView:q,onViewLoad:P,onViewNameChange:H,onViewIdChange:K}),(0,a.jsx)("div",{className:"flex-1 min-w-[200px]",children:(0,a.jsxs)(Q,{type:"single",value:q.viewType||"table",onValueChange:e=>{e&&P({...q,viewType:e})},className:"justify-start",children:[(0,a.jsx)(W,{value:"table","aria-label":"Table view",title:"Table",children:(0,a.jsx)(j.Table2,{className:"h-4 w-4"})}),(0,a.jsx)(W,{value:"card","aria-label":"Card view",title:"Card",children:(0,a.jsx)(p.LayoutGrid,{className:"h-4 w-4"})}),(0,a.jsx)(W,{value:"kanban","aria-label":"Kanban view",title:"Kanban",children:(0,a.jsx)(f.Columns3,{className:"h-4 w-4"})}),(0,a.jsx)(W,{value:"gallery","aria-label":"Gallery view",title:"Gallery",children:(0,a.jsx)(v.Images,{className:"h-4 w-4"})}),(0,a.jsx)(W,{value:"list","aria-label":"List view",title:"List",children:(0,a.jsx)(y.List,{className:"h-4 w-4"})}),(0,a.jsx)(W,{value:"timeline","aria-label":"Timeline view",title:"Timeline",children:(0,a.jsx)(C.Clock,{className:"h-4 w-4"})}),(0,a.jsx)(W,{value:"calendar","aria-label":"Calendar view",title:"Calendar",children:(0,a.jsx)(b.Calendar,{className:"h-4 w-4"})}),(0,a.jsx)(W,{value:"gantt","aria-label":"Gantt view",title:"Gantt",children:(0,a.jsx)(w.BarChart3,{className:"h-4 w-4"})})]})})]}),(0,a.jsx)(n.Input,{placeholder:"Search records...",value:I,onChange:e=>L(e.target.value)})]}),0===ea.length?(0,a.jsx)("div",{className:"text-center py-12 text-muted-foreground",children:I?"No records match your search":"No records yet"}):(()=>{let e=q.viewType||"table",l={records:ea,fields:F,onEdit:e=>{R(e),E(!0)},onDelete:e=>G(e.id),onTogglePublish:e=>J(e.id,e.is_published)};switch(e){case"card":return(0,a.jsx)(ef.CardView,{...l,cardLayout:q.cardLayout});case"kanban":return(0,a.jsx)(ev.KanbanView,{...l,kanbanConfig:q.kanbanConfig});case"gallery":return(0,a.jsx)(ey.GalleryView,{...l,galleryConfig:q.galleryConfig});case"list":return(0,a.jsx)(eC.ListView,{...l,listConfig:q.listConfig});case"timeline":return(0,a.jsx)(eb.TimelineView,{...l,timelineConfig:q.timelineConfig});case"calendar":return(0,a.jsx)(ew.CalendarView,{...l,calendarConfig:q.calendarConfig});case"gantt":return(0,a.jsx)(eN.GanttView,{...l,ganttConfig:q.ganttConfig,entityId:h});default:return(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(eS.Table,{children:[(0,a.jsx)(eS.TableHeader,{children:(0,a.jsxs)(eS.TableRow,{children:[(0,a.jsx)(eS.TableHead,{className:"w-24",children:"Status"}),el.map(e=>(0,a.jsx)(eS.TableHead,{className:"min-w-[150px]",children:(0,a.jsx)("div",{className:"flex items-center justify-between",children:e.display_name})},e.id)),(0,a.jsx)(eS.TableHead,{className:"w-32 text-right sticky right-0 bg-card",children:"Actions"})]})}),(0,a.jsx)(eS.TableBody,{children:ea.map(e=>(0,a.jsxs)(eS.TableRow,{children:[(0,a.jsx)(eS.TableCell,{children:(0,a.jsx)(eF.Badge,{variant:e.is_published?"default":"secondary",children:e.is_published?"Published":"Draft"})}),el.map(l=>(0,a.jsx)(eS.TableCell,{className:"max-w-xs",children:(0,a.jsx)("div",{className:"truncate",children:l.field_type===es.E_FieldDataType.Boolean?e.data[l.name]?"✓":"✗":e.data[l.name]||"-"})},l.id)),(0,a.jsx)(eS.TableCell,{className:"sticky right-0 bg-card",children:(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)(i.Button,{variant:"ghost",size:"icon",onClick:()=>J(e.id,e.is_published),children:e.is_published?(0,a.jsx)(x.EyeOff,{className:"h-4 w-4"}):(0,a.jsx)(u.Eye,{className:"h-4 w-4"})}),(0,a.jsx)(i.Button,{variant:"ghost",size:"icon",onClick:()=>{R(e),E(!0)},children:(0,a.jsx)(o.Edit,{className:"h-4 w-4"})}),(0,a.jsx)(i.Button,{variant:"ghost",size:"icon",onClick:()=>G(e.id),children:(0,a.jsx)(m.Trash2,{className:"h-4 w-4 text-destructive"})})]})})]},e.id))})]})})}})()]})]})}),(0,a.jsx)(en,{open:B,onOpenChange:E,entityId:h,fields:F,record:A,onSuccess:M}),(0,a.jsx)(ej.AlertDialog,{open:!!O,onOpenChange:()=>G(null),children:(0,a.jsxs)(ej.AlertDialogContent,{children:[(0,a.jsxs)(ej.AlertDialogHeader,{children:[(0,a.jsx)(ej.AlertDialogTitle,{children:"Delete Record"}),(0,a.jsx)(ej.AlertDialogDescription,{children:"Are you sure you want to delete this record? This action cannot be undone."})]}),(0,a.jsxs)(ej.AlertDialogFooter,{children:[(0,a.jsx)(ej.AlertDialogCancel,{children:"Cancel"}),(0,a.jsx)(ej.AlertDialogAction,{onClick:Y,children:"Delete"})]})]})})]}):null}],65953)}]);