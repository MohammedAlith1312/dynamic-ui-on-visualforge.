module.exports=[47525,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(74167),f=a.i(85822),g=a.i(99570),h=a.i(80701),i=a.i(70430),j=a.i(23292),k=a.i(210),l=a.i(77156),m=a.i(41379),n=a.i(72857),o=a.i(3699),p=a.i(78036),q=a.i(67438),r=a.i(49741),s=a.i(49140),t=a.i(69876),u=a.i(14512),v=a.i(50522),w=a.i(5784),x=a.i(43108),y=a.i(70106);let z=(0,y.default)("LockOpen",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);var A=a.i(84581),B=a.i(68114);let C=({id:a,label:c,type:d,componentType:e,visible:f=!0,locked:h=!1,isSelected:i=!1,hasChildren:j=!1,isExpanded:k=!0,onToggleExpand:n,level:o,onToggleVisibility:p,onToggleLock:q,onSelect:r})=>{let{attributes:t,listeners:y,setNodeRef:C,transform:D,transition:E,isDragging:F}=(0,s.useSortable)({id:a,disabled:h,data:{type:d,id:a}}),G={transform:u.CSS.Transform.toString(D),transition:E,opacity:F?.5:1};return(0,b.jsxs)("div",{ref:C,style:G,className:(0,B.cn)("group flex items-center gap-1 py-1 px-2 rounded transition-colors","component"===d&&"cursor-pointer","component"===d&&"hover:bg-accent","component"!==d&&"hover:bg-muted/50",i&&"bg-primary/10 border-l-2 border-primary",!f&&"opacity-50",h&&"cursor-not-allowed"),children:[(0,b.jsxs)("div",{style:{marginLeft:`${16*o}px`},className:"flex items-center gap-1 flex-1 min-w-0",children:[j&&(0,b.jsx)(g.Button,{variant:"ghost",size:"icon",className:"h-4 w-4 p-0 hover:bg-accent",onClick:a=>{a.stopPropagation(),n?.()},children:k?(0,b.jsx)(w.ChevronDown,{className:"h-3 w-3"}):(0,b.jsx)(v.ChevronRight,{className:"h-3 w-3"})}),!j&&(0,b.jsx)("div",{className:"w-4"}),(0,b.jsx)("div",{...t,...y,className:(0,B.cn)("cursor-grab active:cursor-grabbing opacity-0 group-hover:opacity-100 shrink-0",h&&"cursor-not-allowed opacity-30"),onPointerDown:a=>a.stopPropagation(),children:(0,b.jsx)(A.GripVertical,{className:"h-3 w-3 text-muted-foreground"})}),(0,b.jsx)("span",{className:"text-sm mr-1",children:"row"===d?"ðŸ“":"column"===d?"ðŸ“¦":({heading:"ðŸ“",paragraph:"ðŸ“„",image:"ðŸ–¼ï¸",button:"ðŸ”˜",link:"ðŸ”—",video:"ðŸŽ¥",divider:"âž–",spacer:"â¬œ",quote:"ðŸ’¬",list:"ðŸ“‹",code:"ðŸ’»",chart:"ðŸ“Š",tabs:"ðŸ“‘",accordion:"ðŸ—‚ï¸",card:"ðŸƒ","form-input":"ðŸ“","form-textarea":"ðŸ“","form-select":"ðŸ”½","form-checkbox":"â˜‘ï¸","form-submit":"âœ…"})[e||""]||"ðŸ“¦"}),(0,b.jsx)("span",{className:(0,B.cn)("text-sm truncate flex-1","component"===d&&"cursor-pointer",!f&&"line-through"),onClick:b=>{"component"===d&&r&&(b.stopPropagation(),b.preventDefault(),console.log("[OutlineTreeItem] Label clicked, selecting:",a),r())},children:c})]}),(0,b.jsxs)("div",{className:"flex items-center gap-0.5 shrink-0",children:["component"===d&&p&&(0,b.jsx)(g.Button,{variant:"ghost",size:"icon",className:"h-6 w-6 hover:bg-accent shrink-0",onPointerDown:a=>{a.stopPropagation()},onClick:b=>{b.stopPropagation(),b.preventDefault(),console.log("[OutlineTreeItem] Visibility clicked for:",a,f),p()},title:f?"Hide component":"Show component",children:f?(0,b.jsx)(l.Eye,{className:"h-3 w-3 text-muted-foreground"}):(0,b.jsx)(m.EyeOff,{className:"h-3 w-3 text-destructive"})}),"component"===d&&q&&(0,b.jsx)(g.Button,{variant:"ghost",size:"icon",className:"h-6 w-6 hover:bg-accent shrink-0",onPointerDown:a=>{a.stopPropagation()},onClick:b=>{b.stopPropagation(),b.preventDefault(),console.log("[OutlineTreeItem] Lock clicked for:",a,h),q()},title:h?"Unlock component":"Lock component",children:h?(0,b.jsx)(x.Lock,{className:"h-3 w-3 text-orange-500"}):(0,b.jsx)(z,{className:"h-3 w-3 text-muted-foreground"})})]})]})};var D=a.i(5084);let E=({title:a,rows:d,components:e,selectedComponentId:f,onSelectComponent:g,onToggleVisibility:h,onToggleLock:i})=>{let[j,k]=(0,c.useState)(new Set(d.map(a=>a.id))),[l,m]=(0,c.useState)(new Set),n=[...d].sort((a,b)=>a.position-b.position);return(0,b.jsx)(r.DndContext,{collisionDetection:r.closestCenter,onDragEnd:a=>{console.log("Drag ended in outline:",a)},children:(0,b.jsxs)("div",{className:"flex flex-col h-full bg-background",children:[(0,b.jsxs)("div",{className:"p-4 border-b",children:[(0,b.jsx)("h3",{className:"font-semibold text-sm",children:a}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[d.length," row",1!==d.length?"s":"",", ",e.length," component",1!==e.length?"s":""]})]}),(0,b.jsx)(t.ScrollArea,{className:"flex-1",children:(0,b.jsx)(s.SortableContext,{items:e.map(a=>a.id),strategy:s.verticalListSortingStrategy,children:(0,b.jsx)("div",{className:"p-2 space-y-1",children:0===n.length?(0,b.jsx)("div",{className:"text-center py-8 text-sm text-muted-foreground",children:"No content yet"}):n.map((a,c)=>{let d=j.has(a.id);return(0,b.jsxs)("div",{children:[(0,b.jsx)(C,{id:`row-${a.id}`,label:`Row ${c+1} (${a.columns} column${1!==a.columns?"s":""})`,type:"row",level:0,hasChildren:!0,isExpanded:d,onToggleExpand:()=>{var b;return b=a.id,void k(a=>{let c=new Set(a);return c.has(b)?c.delete(b):c.add(b),c})},onSelect:()=>{}}),d&&Array.from({length:a.columns},(c,d)=>{let j,k=(j=a.id,e.filter(a=>a.row_id===j&&a.column_index===d).sort((a,b)=>a.position-b.position)),n=`${a.id}-${d}`,o=l.has(n);return(0,b.jsxs)("div",{children:[a.columns>1&&(0,b.jsx)(C,{id:`col-${n}`,label:`Column ${d+1}`,type:"column",level:1,hasChildren:k.length>0,isExpanded:o,onToggleExpand:()=>{m(a=>{let b=new Set(a);return b.has(n)?b.delete(n):b.add(n),b})},onSelect:()=>{}}),(1===a.columns||o)&&k.map(c=>{let d,e;return console.log("[OutlinePanel] Rendering component:",c.id,{hasVisibilityHandler:!!h,hasLockHandler:!!i,hasSelectHandler:!!g}),(0,b.jsx)(C,{id:c.id,label:(d=c.content,e=c.component_type,d?.text?d.text.substring(0,30):d?.title?d.title.substring(0,30):d?.label?d.label.substring(0,30):d?.alt?d.alt.substring(0,30):e.split("-").map(a=>a.charAt(0).toUpperCase()+a.slice(1)).join(" ")),type:"component",componentType:c.component_type,level:a.columns>1?2:1,visible:!1!==(c.styles||{}).visible,locked:!0===(c.styles||{}).locked,isSelected:f===c.id,onSelect:()=>{console.log("[OutlinePanel] onSelect called for:",c.id),g(c.id)},onToggleVisibility:()=>{console.log("[OutlinePanel] onToggleVisibility called for:",c.id),h(c.id)},onToggleLock:()=>{console.log("[OutlinePanel] onToggleLock called for:",c.id),i(c.id)}},c.id)})]},n)}),c<n.length-1&&(0,b.jsx)(D.Separator,{className:"my-2"})]},a.id)})})})})]})})};var F=a.i(88621),G=a.i(67329);let H=(0,y.default)("Shapes",[["path",{d:"M8.3 10a.7.7 0 0 1-.626-1.079L11.4 3a.7.7 0 0 1 1.198-.043L16.3 8.9a.7.7 0 0 1-.572 1.1Z",key:"1bo67w"}],["rect",{x:"3",y:"14",width:"7",height:"7",rx:"1",key:"1bkyp8"}],["circle",{cx:"17.5",cy:"17.5",r:"3.5",key:"w3z12y"}]]),I=({showOutline:a,onToggle:c,title:d,rows:e,components:f,selectedComponentId:h,onSelectComponent:i,onToggleVisibility:j,onToggleLock:k,isLayoutEditor:l=!1})=>a?(0,b.jsxs)(F.Sidebar,{children:[(0,b.jsx)(F.SidebarHeader,{className:"p-4 border-b",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h3",{className:"font-semibold",children:"Structure"}),(0,b.jsxs)(g.Button,{variant:"ghost",size:"sm",onClick:c,className:"gap-2",title:"Switch to Components",children:[(0,b.jsx)(H,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"text-xs",children:"Components"})]})]})}),(0,b.jsx)(F.SidebarContent,{className:"p-0",children:(0,b.jsx)(E,{title:d,rows:e,components:f,selectedComponentId:h,onSelectComponent:i,onToggleVisibility:j,onToggleLock:k})})]}):(0,b.jsx)(q.ComponentsSidebar,{isLayoutEditor:l,renderHeader:()=>(0,b.jsx)("div",{className:"p-4 border-b bg-muted/30",children:(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("h3",{className:"font-semibold text-sm",children:"Add Components"}),(0,b.jsxs)(g.Button,{variant:"ghost",size:"sm",onClick:c,className:"gap-1 h-8",title:"Switch to Outline View",children:[(0,b.jsx)(G.List,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"text-xs",children:"Outline"})]})]})})});var J=a.i(49967),K=a.i(9599),L=a.i(74157),M=a.i(64864);a.s(["default",0,()=>{let a=(0,d.useParams)().pageId,q=(0,d.useRouter)(),{copiedComponent:s}=(0,f.useClipboard)(),[t,u]=(0,c.useState)(null),[v,w]=(0,c.useState)([]),[x,y]=(0,c.useState)([]),[z,A]=(0,c.useState)(!0),[B,C]=(0,c.useState)(!1),[D,E]=(0,c.useState)(null),[G,H]=(0,c.useState)([]),[N,O]=(0,c.useState)(null),[P,Q]=(0,c.useState)([]),[R,S]=(0,c.useState)([]),[T,U]=(0,c.useState)(new Map),[V,W]=(0,c.useState)(null),[X,Y]=(0,c.useState)(!1),Z=(0,L.useHistory)();(0,M.useKeyboardShortcuts)({onUndo:()=>Z.canUndo&&Z.undo(),onRedo:()=>Z.canRedo&&Z.redo(),onDelete:()=>V&&aj(V),onDuplicate:()=>V&&al(V)}),(0,c.useEffect)(()=>{_(),$()},[a]);let $=async()=>{let{data:a}=await e.supabase.from("layouts").select("*").eq("is_published",!0).order("title");H(a||[])},_=async()=>{if(!a)return;let{data:b,error:c}=await e.supabase.from("pages").select("*").eq("id",a).single();if(c){j.toast.error("Failed to load page"),q.push("/admin");return}let{data:d}=await e.supabase.from("page_rows").select("*").eq("page_id",a).order("position"),{data:f}=await e.supabase.from("page_components").select("*").eq("page_id",a).order("position");u(b),w(d||[]),y(f||[]),A(!1)},aa=async()=>{if(!a)return;let{data:b,error:c}=await e.supabase.from("page_rows").insert({page_id:a,position:v.length,columns:1}).select().single();c?j.toast.error("Failed to add row"):(w([...v,b]),j.toast.success("Row added"))},ab=async a=>{if(!confirm("Delete this row and all its components?"))return;let{error:b}=await e.supabase.from("page_rows").delete().eq("id",a);b?j.toast.error("Failed to delete row"):(w(v.filter(b=>b.id!==a)),y(x.filter(b=>b.row_id!==a)),j.toast.success("Row deleted"))},ac=async(a,b)=>{let{error:c}=await e.supabase.from("page_rows").update({columns:b}).eq("id",a);c?j.toast.error("Failed to update columns"):w(v.map(c=>c.id===a?{...c,columns:b}:c))},ad=async(a,b)=>{let{error:c}=await e.supabase.from("page_rows").update({styles:b}).eq("id",a);c?j.toast.error("Failed to update row styles"):w(v.map(c=>c.id===a?{...c,styles:b}:c))},ae=async(a,b)=>{let{error:c}=await e.supabase.from("page_rows").update({column_widths:b}).eq("id",a);c?j.toast.error("Failed to update column widths"):w(v.map(c=>c.id===a?{...c,column_widths:b}:c))},af=async(a,b)=>{let{error:c}=await e.supabase.from("page_rows").update({responsive_config:b}).eq("id",a);c?j.toast.error("Failed to update responsive config"):w(v.map(c=>c.id===a?{...c,responsive_config:b}:c))},ag=async(a,b)=>{let{error:c}=await e.supabase.from("page_components").update({styles:b}).eq("id",a);c?j.toast.error("Failed to update component styles"):y(x.map(c=>c.id===a?{...c,styles:b}:c))},ah=async a=>{w(a);for(let b=0;b<a.length;b++)await e.supabase.from("page_rows").update({position:b}).eq("id",a[b].id)},ai=async(a,b)=>{let{error:c}=await e.supabase.from("page_components").update({content:b}).eq("id",a);c?j.toast.error("Failed to update component"):y(x.map(c=>c.id===a?{...c,content:b}:c))},aj=async a=>{let{error:b}=await e.supabase.from("page_components").delete().eq("id",a);b?j.toast.error("Failed to delete component"):(y(x.filter(b=>b.id!==a)),j.toast.success("Component deleted"))},ak=async b=>{if(a){for(let c of b.rows||[]){let{data:b,error:d}=await e.supabase.from("page_rows").insert({page_id:a,position:v.length,columns:c.columns||1,column_widths:c.column_widths||[],styles:c.styles||{}}).select().single();if(d||!b){j.toast.error("Failed to insert template row");continue}for(let d of c.components||[])await e.supabase.from("page_components").insert({page_id:a,row_id:b.id,component_type:d.component_type,column_index:d.column_index,position:d.position,content:d.content||{},styles:d.styles||{}})}await _(),j.toast.success("Template inserted successfully")}},al=async b=>{let c=x.find(a=>a.id===b);if(!c||!a)return;let d=x.filter(a=>a.row_id===c.row_id&&a.column_index===c.column_index),{data:f,error:g}=await e.supabase.from("page_components").insert({page_id:a,row_id:c.row_id,column_index:c.column_index,component_type:c.component_type,content:c.content,position:d.length,is_widget_instance:c.is_widget_instance,widget_id:c.widget_id}).select().single();g?j.toast.error("Failed to duplicate component"):(y([...x,f]),j.toast.success("Component duplicated"))},am=async(b,c)=>{if(!s||!a)return;let d=x.filter(a=>a.row_id===b&&a.column_index===c),{data:f,error:g}=await e.supabase.from("page_components").insert({page_id:a,row_id:b,column_index:c,component_type:s.component_type,content:s.content,position:d.length,is_widget_instance:s.is_widget_instance,widget_id:s.widget_id}).select().single();g?j.toast.error("Failed to paste component"):(y([...x,f]),j.toast.success("Component pasted"))},an=async(a,b)=>{let c=x.find(b=>b.id===a);if(!c)return;let d=x.filter(a=>a.row_id===c.row_id&&a.column_index===c.column_index).sort((a,b)=>a.position-b.position).map((d,f)=>d.id===a?e.supabase.from("page_components").update({position:b}).eq("id",d.id):f>=b&&d.position<c.position?e.supabase.from("page_components").update({position:f+1}).eq("id",d.id):f<=b&&d.position>c.position?e.supabase.from("page_components").update({position:f-1}).eq("id",d.id):null).filter(Boolean);await Promise.all(d),await _(),j.toast.success("Component moved")},ao=async b=>{let c=v.find(a=>a.id===b);if(!c||!a)return;let{error:d}=await e.supabase.from("page_rows").insert({page_id:a,position:c.position,columns:1});if(d)return void j.toast.error("Failed to add row");let f=v.filter(a=>a.position>=c.position);await Promise.all(f.map(a=>e.supabase.from("page_rows").update({position:a.position+1}).eq("id",a.id))),await _(),j.toast.success("Row added")},ap=async b=>{let c=v.find(a=>a.id===b);if(!c||!a)return;let{error:d}=await e.supabase.from("page_rows").insert({page_id:a,position:c.position+1,columns:1});if(d)return void j.toast.error("Failed to add row");let f=v.filter(a=>a.position>c.position);await Promise.all(f.map(a=>e.supabase.from("page_rows").update({position:a.position+1}).eq("id",a.id))),await _(),j.toast.success("Row added")},aq=async b=>{let c=v.find(a=>a.id===b);if(!c||!a)return;let{data:d,error:f}=await e.supabase.from("page_rows").insert({page_id:a,position:c.position+1,columns:c.columns,styles:c.styles,column_widths:c.column_widths}).select().single();if(f||!d)return void j.toast.error("Failed to duplicate row");let g=x.filter(a=>a.row_id===b);await Promise.all(g.map(b=>e.supabase.from("page_components").insert({page_id:a,row_id:d.id,column_index:b.column_index,position:b.position,component_type:b.component_type,content:b.content,styles:b.styles}))),await _(),j.toast.success("Row duplicated")},ar=async a=>{console.log("[PageEditor] Toggle visibility for:",a);let b=x.find(b=>b.id===a);if(!b)return void console.log("[PageEditor] Component not found!");let c=b.styles||{},d=!1!==c.visible,f=!d;console.log("[PageEditor] Visibility change:",{currentVisible:d,newVisible:f,currentStyles:c});let{error:g}=await e.supabase.from("page_components").update({styles:{...c,visible:f}}).eq("id",a);if(g){console.error("[PageEditor] Error updating visibility:",g),j.toast.error("Failed to update visibility");return}await _(),j.toast.success(f?"Component shown":"Component hidden")},as=async a=>{console.log("[PageEditor] Toggle lock for:",a);let b=x.find(b=>b.id===a);if(!b)return void console.log("[PageEditor] Component not found!");let c=b.styles||{},d=!c.locked;console.log("[PageEditor] Lock change:",{currentLocked:c.locked,newLocked:d,currentStyles:c});let{error:f}=await e.supabase.from("page_components").update({styles:{...c,locked:d}}).eq("id",a);if(f){console.error("[PageEditor] Error updating lock:",f),j.toast.error("Failed to update lock");return}await _(),j.toast.success(d?"Component locked":"Component unlocked")},at=async b=>{let{active:c,over:d}=b;if(!d)return void E(null);let f=c.id,g=c.data.current,h=d.data.current;if((f.startsWith("new-")||f.startsWith("new-widget-"))&&(g?.type==="new-component"||g?.type==="new-widget")){let b=h?.rowId,c=h?.columnIndex;if(!b||null===c||!a)return void E(null);let d=x.filter(a=>a.row_id===b&&a.column_index===c);if("new-widget"===g.type){let{data:f,error:h}=await e.supabase.from("page_components").insert({page_id:a,row_id:b,column_index:c,component_type:"paragraph",content:{text:`Widget: ${g.widgetTitle}`},position:d.length,is_widget_instance:!0,widget_id:g.widgetId}).select().single();h?j.toast.error("Failed to add widget"):(y([...x,f]),j.toast.success("Widget added"))}else{let f=g.componentType,{data:h,error:i}=await e.supabase.from("page_components").insert({page_id:a,row_id:b,column_index:c,component_type:f,content:(a=>{switch(a){case"heading":return{text:"New Heading",level:"h2"};case"paragraph":return{text:"New paragraph text"};case"image":return{url:"",alt:"Image"};case"button":return{text:"Click me",link:""};case"link":return{text:"Link",url:""};case"video":return{url:""};case"divider":case"page-content":default:return{};case"spacer":return{height:"medium"};case"quote":return{text:"Quote text",author:""};case"list":return{items:"Item 1\nItem 2\nItem 3",type:"bullet"};case"code":return{code:"console.log('Hello');",language:"javascript"};case"entity-list":return{entityId:"",fields:[],displayStyle:"grid",limit:10,sortBy:"",sortOrder:"desc",showPublishedOnly:!0};case"entity-detail":return{entityId:"",recordId:"",fields:[],layout:"vertical"};case"query":return{queryId:""};case"datasource":return{dataSourceType:"entity",viewType:"table",viewOptions:{visibleColumns:[],sortField:null,sortOrder:"asc",filters:[]}};case"chart":return{chartType:"bar",data:JSON.stringify([{name:"Jan",value:400},{name:"Feb",value:300},{name:"Mar",value:600},{name:"Apr",value:800},{name:"May",value:500},{name:"Jun",value:700}],null,2),title:"Sample Bar Chart",xAxisKey:"name",yAxisKey:"value"};case"tabs":return{tabs:[{id:"tab-1",label:"Tab 1",content:"Content 1"},{id:"tab-2",label:"Tab 2",content:"Content 2"}]};case"accordion":return{items:[{id:"item-1",title:"Section 1",content:"Content 1"},{id:"item-2",title:"Section 2",content:"Content 2"}]};case"card":return{layout:"image-top",title:"Card Title",description:"Card description",imageUrl:"",buttonText:"Learn More",buttonLink:""};case"form-input":return{fieldName:"field_name",label:"Field Label",placeholder:"Enter value...",inputType:"text",required:!1};case"form-textarea":return{fieldName:"message",label:"Message",placeholder:"Enter your message...",rows:4,required:!1};case"form-select":return{fieldName:"select_field",label:"Select Option",placeholder:"Choose...",options:"Option 1\nOption 2\nOption 3",required:!1};case"form-checkbox":return{fieldName:"checkbox_field",label:"Select Options",options:"Option 1\nOption 2\nOption 3",type:"checkbox",required:!1};case"form-submit":return{buttonText:"Submit",buttonVariant:"default",successMessage:"Form submitted successfully!",submitAction:"custom"}}})(f),position:d.length}).select().single();i?j.toast.error("Failed to add component"):(y([...x,h]),j.toast.success("Component added"))}return void E(null)}let i=x.find(a=>a.id===f);if(!i)return void E(null);await e.supabase.from("page_components").update({row_id:i.row_id,column_index:i.column_index}).eq("id",f);let k=x.filter(a=>a.row_id===i.row_id&&a.column_index===i.column_index).sort((a,b)=>a.position-b.position);for(let a=0;a<k.length;a++)await e.supabase.from("page_components").update({position:a}).eq("id",k[a].id);E(null)},au=async()=>{if(!t)return;let a=null,b=[],c=[];if(t.layout_id){let{data:d}=await e.supabase.from("layouts").select("*").eq("id",t.layout_id).single();if(d){a=d;let{data:f}=await e.supabase.from("layout_rows").select("*").eq("layout_id",t.layout_id).order("position"),{data:g}=await e.supabase.from("layout_components").select("*").eq("layout_id",t.layout_id).order("position");b=f||[],c=g||[]}}let d=x.filter(a=>!!(a.is_widget_instance&&a.widget_id)),f=new Map;for(let a of d)if(!f.has(a.widget_id)){let{data:b}=await e.supabase.from("widget_rows").select("*").eq("widget_id",a.widget_id).order("position"),{data:c}=await e.supabase.from("widget_components").select("*").eq("widget_id",a.widget_id).order("position");f.set(a.widget_id,{rows:b||[],components:c||[]})}O(a),Q(b),S(c),U(f),C(!0)},av=async a=>{if(!t)return;let{error:b}=await e.supabase.from("pages").update({layout_id:a||null}).eq("id",t.id);b?j.toast.error("Failed to update layout"):(u({...t,layout_id:a||null}),j.toast.success("Layout updated"))};return z?(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:"Loading..."}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(J.PagePreviewModal,{open:B,onOpenChange:C,page:t,rows:v,components:x,layout:N,layoutRows:P,layoutComponents:R,widgetData:T}),(0,b.jsx)(r.DndContext,{collisionDetection:r.pointerWithin,onDragStart:a=>{let{active:b}=a,c=b.data.current;c?.type==="new-component"?E(c.componentType):c?.type==="new-widget"&&E("widget")},onDragEnd:at,onDragOver:a=>{let{active:b,over:c}=a;if(!c)return;let d=b.id;c.id;let e=b.data.current,f=c.data.current;if(e?.type==="component"&&f?.type==="droppable-column"){let a=e.component,b=f.rowId,c=f.columnIndex;(a.row_id!==b||a.column_index!==c)&&y(x.map(a=>a.id===d?{...a,row_id:b,column_index:c}:a))}},children:(0,b.jsx)(F.SidebarProvider,{children:(0,b.jsxs)("div",{className:"min-h-screen flex w-full bg-background",children:[(0,b.jsx)(I,{showOutline:X,onToggle:()=>Y(!X),title:t?.title||"Page",rows:v,components:x,selectedComponentId:V,onSelectComponent:W,onToggleVisibility:ar,onToggleLock:as}),(0,b.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,b.jsx)("header",{className:"border-b bg-card shadow-[var(--shadow-soft)] sticky top-0 z-50",children:(0,b.jsxs)("div",{className:"px-4 py-3 flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)(F.SidebarTrigger,{}),(0,b.jsxs)(g.Button,{variant:"outline",onClick:()=>q.push("/admin"),className:"gap-2",children:[(0,b.jsx)(k.ArrowLeft,{className:"h-4 w-4"}),"Back"]}),(0,b.jsx)("h1",{className:"text-xl font-bold",children:t?.title})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(i.Label,{htmlFor:"layout-select",className:"text-sm",children:"Layout:"}),(0,b.jsxs)(h.Select,{value:t?.layout_id??"none",onValueChange:a=>av("none"===a?null:a),children:[(0,b.jsx)(h.SelectTrigger,{id:"layout-select",className:"w-[200px]",children:(0,b.jsx)(h.SelectValue,{placeholder:"No layout"})}),(0,b.jsxs)(h.SelectContent,{children:[(0,b.jsx)(h.SelectItem,{value:"none",children:"No layout"}),G.map(a=>(0,b.jsx)(h.SelectItem,{value:a.id,children:a.title},a.id))]})]})]}),(0,b.jsx)(g.Button,{variant:"ghost",size:"icon",onClick:()=>Z.undo(),disabled:!Z.canUndo,title:"Undo (Cmd+Z)",children:(0,b.jsx)(o.Undo,{className:"h-4 w-4"})}),(0,b.jsx)(g.Button,{variant:"ghost",size:"icon",onClick:()=>Z.redo(),disabled:!Z.canRedo,title:"Redo (Cmd+Shift+Z)",children:(0,b.jsx)(p.Redo,{className:"h-4 w-4"})}),(0,b.jsxs)(g.Button,{variant:"outline",onClick:au,className:"gap-2",children:[(0,b.jsx)(n.Monitor,{className:"h-4 w-4"}),"Preview"]}),(0,b.jsx)(g.Button,{variant:t?.is_published?"outline":"default",className:"gap-2",children:t?.is_published?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(m.EyeOff,{className:"h-4 w-4"}),"Unpublish"]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(l.Eye,{className:"h-4 w-4"}),"Publish"]})})]})]})}),(0,b.jsx)("main",{className:"flex-1 overflow-auto px-4 py-8",children:(0,b.jsx)(K.GridCanvas,{rows:v,components:x,onUpdateComponent:ai,onUpdateComponentStyles:ag,onDeleteComponent:aj,onAddRow:aa,onDeleteRow:ab,onUpdateRowColumns:ac,onUpdateRowStyles:ad,onUpdateRowColumnWidths:ae,onUpdateRowResponsiveConfig:af,onReorderRows:ah,activeComponentType:D,onDuplicateComponent:al,onPasteComponent:am,onInsertTemplate:ak,onMoveComponentToPosition:an,onAddRowAbove:ao,onAddRowBelow:ap,onDuplicateRow:aq})})]})]})})})]})}],47525)}];

//# sourceMappingURL=src_views_PageEditor_tsx_3b8214d5._.js.map