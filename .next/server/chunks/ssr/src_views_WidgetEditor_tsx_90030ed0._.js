module.exports=[30015,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(74167),f=a.i(85822),g=a.i(99570),h=a.i(23292),i=a.i(210),j=a.i(77156),k=a.i(41379),l=a.i(72857),m=a.i(3699),n=a.i(78036),o=a.i(67438),p=a.i(9599),q=a.i(88621),r=a.i(49741),s=a.i(21118),t=a.i(74157),u=a.i(64864);a.s(["default",0,()=>{let a=(0,d.useParams)().widgetId,v=(0,d.useRouter)(),{copiedComponent:w}=(0,f.useClipboard)(),[x,y]=(0,c.useState)(null),[z,A]=(0,c.useState)([]),[B,C]=(0,c.useState)([]),[D,E]=(0,c.useState)(!0),[F,G]=(0,c.useState)(null),[H,I]=(0,c.useState)(!1),[J,K]=(0,c.useState)(null),L=(0,t.useHistory)();(0,u.useKeyboardShortcuts)({onUndo:()=>L.canUndo&&L.undo(),onRedo:()=>L.canRedo&&L.redo(),onDelete:()=>J&&W(J),onDuplicate:()=>J&&Y(J)}),(0,c.useEffect)(()=>{M()},[a]);let M=async()=>{if(!a)return;let{data:b,error:c}=await e.supabase.from("widgets").select("*").eq("id",a).single();if(c){h.toast.error("Failed to load widget"),v.push("/admin/widgets");return}let{data:d}=await e.supabase.from("widget_rows").select("*").eq("widget_id",a).order("position"),{data:f}=await e.supabase.from("widget_components").select("*").eq("widget_id",a).order("position");y(b),A(d||[]),C(f||[]),E(!1)},N=async()=>{if(!a)return;let{data:b,error:c}=await e.supabase.from("widget_rows").insert({widget_id:a,position:z.length,columns:1}).select().single();c?h.toast.error("Failed to add row"):(A([...z,b]),h.toast.success("Row added"))},O=async a=>{if(!confirm("Delete this row and all its components?"))return;let{error:b}=await e.supabase.from("widget_rows").delete().eq("id",a);b?h.toast.error("Failed to delete row"):(A(z.filter(b=>b.id!==a)),C(B.filter(b=>b.row_id!==a)),h.toast.success("Row deleted"))},P=async(a,b)=>{let c=z.find(b=>b.id===a);c&&L.execute({execute:async()=>{let{error:c}=await e.supabase.from("widget_rows").update({columns:b}).eq("id",a);c?h.toast.error("Failed to update columns"):A(z.map(c=>c.id===a?{...c,columns:b}:c))},undo:async()=>{await e.supabase.from("widget_rows").update({columns:c.columns}).eq("id",a),A(z.map(b=>b.id===a?{...b,columns:c.columns}:b))}})},Q=async(a,b)=>{let{error:c}=await e.supabase.from("widget_rows").update({styles:b}).eq("id",a);c?h.toast.error("Failed to update row styles"):A(z.map(c=>c.id===a?{...c,styles:b}:c))},R=async(a,b)=>{let{error:c}=await e.supabase.from("widget_rows").update({column_widths:b}).eq("id",a);c?h.toast.error("Failed to update column widths"):A(z.map(c=>c.id===a?{...c,column_widths:b}:c))},S=async(a,b)=>{let{error:c}=await e.supabase.from("widget_rows").update({responsive_config:b}).eq("id",a);c?h.toast.error("Failed to update responsive config"):A(z.map(c=>c.id===a?{...c,responsive_config:b}:c))},T=async(a,b)=>{let{error:c}=await e.supabase.from("widget_components").update({styles:b}).eq("id",a);c?h.toast.error("Failed to update component styles"):C(B.map(c=>c.id===a?{...c,styles:b}:c))},U=async a=>{A(a);for(let b=0;b<a.length;b++)await e.supabase.from("widget_rows").update({position:b}).eq("id",a[b].id)},V=async(a,b)=>{let{error:c}=await e.supabase.from("widget_components").update({content:b}).eq("id",a);c?h.toast.error("Failed to update component"):C(B.map(c=>c.id===a?{...c,content:b}:c))},W=async a=>{let{error:b}=await e.supabase.from("widget_components").delete().eq("id",a);b?h.toast.error("Failed to delete component"):(C(B.filter(b=>b.id!==a)),h.toast.success("Component deleted"))},X=async b=>{if(a){for(let c of b.rows||[]){let{data:b,error:d}=await e.supabase.from("widget_rows").insert({widget_id:a,position:z.length,columns:c.columns||1,column_widths:c.column_widths||[],styles:c.styles||{}}).select().single();if(d||!b){h.toast.error("Failed to insert template row");continue}for(let d of c.components||[])await e.supabase.from("widget_components").insert({widget_id:a,row_id:b.id,component_type:d.component_type,column_index:d.column_index,position:d.position,content:d.content||{},styles:d.styles||{}})}await M(),h.toast.success("Template inserted successfully")}},Y=async b=>{let c=B.find(a=>a.id===b);if(!c||!a)return;let d=B.filter(a=>a.row_id===c.row_id&&a.column_index===c.column_index),{data:f,error:g}=await e.supabase.from("widget_components").insert({widget_id:a,row_id:c.row_id,column_index:c.column_index,component_type:c.component_type,content:c.content,position:d.length}).select().single();g?h.toast.error("Failed to duplicate component"):(C([...B,f]),h.toast.success("Component duplicated"))},Z=async(b,c)=>{if(!w||!a)return;let d=B.filter(a=>a.row_id===b&&a.column_index===c),{data:f,error:g}=await e.supabase.from("widget_components").insert({widget_id:a,row_id:b,column_index:c,component_type:w.component_type,content:w.content,position:d.length}).select().single();g?h.toast.error("Failed to paste component"):(C([...B,f]),h.toast.success("Component pasted"))},$=async(a,b)=>{let c=B.find(b=>b.id===a);if(!c)return;let d=B.filter(a=>a.row_id===c.row_id&&a.column_index===c.column_index).sort((a,b)=>a.position-b.position).map((d,f)=>d.id===a?e.supabase.from("widget_components").update({position:b}).eq("id",d.id):f>=b&&d.position<c.position?e.supabase.from("widget_components").update({position:f+1}).eq("id",d.id):f<=b&&d.position>c.position?e.supabase.from("widget_components").update({position:f-1}).eq("id",d.id):null).filter(Boolean);await Promise.all(d),await M(),h.toast.success("Component moved")},_=async b=>{let c=z.find(a=>a.id===b);if(!c||!a)return;let{error:d}=await e.supabase.from("widget_rows").insert({widget_id:a,position:c.position,columns:1});if(d)return void h.toast.error("Failed to add row");let f=z.filter(a=>a.position>=c.position);await Promise.all(f.map(a=>e.supabase.from("widget_rows").update({position:a.position+1}).eq("id",a.id))),await M(),h.toast.success("Row added")},aa=async b=>{let c=z.find(a=>a.id===b);if(!c||!a)return;let{error:d}=await e.supabase.from("widget_rows").insert({widget_id:a,position:c.position+1,columns:1});if(d)return void h.toast.error("Failed to add row");let f=z.filter(a=>a.position>c.position);await Promise.all(f.map(a=>e.supabase.from("widget_rows").update({position:a.position+1}).eq("id",a.id))),await M(),h.toast.success("Row added")},ab=async b=>{let c=z.find(a=>a.id===b);if(!c||!a)return;let{data:d,error:f}=await e.supabase.from("widget_rows").insert({widget_id:a,position:c.position+1,columns:c.columns,styles:c.styles,column_widths:c.column_widths}).select().single();if(f||!d)return void h.toast.error("Failed to duplicate row");let g=B.filter(a=>a.row_id===b);await Promise.all(g.map(b=>e.supabase.from("widget_components").insert({widget_id:a,row_id:d.id,column_index:b.column_index,position:b.position,component_type:b.component_type,content:b.content,styles:b.styles}))),await M(),h.toast.success("Row duplicated")},ac=async b=>{let{active:c,over:d}=b;if(!d)return void G(null);let f=c.id,g=c.data.current,i=d.data.current;if(f.startsWith("new-")&&g?.type==="new-component"){let b=i?.rowId,c=i?.columnIndex;if(!b||null===c||!a)return void G(null);let d=g.componentType,f=B.filter(a=>a.row_id===b&&a.column_index===c),{data:j,error:k}=await e.supabase.from("widget_components").insert({widget_id:a,row_id:b,column_index:c,component_type:d,content:(a=>{switch(a){case"heading":return{text:"New Heading",level:"h2"};case"paragraph":return{text:"New paragraph text"};case"image":return{url:"",alt:"Image"};case"button":return{text:"Click me",link:""};case"link":return{text:"Link",url:""};case"video":return{url:""};case"divider":default:return{};case"spacer":return{height:"medium"};case"quote":return{text:"Quote text",author:""};case"list":return{items:"Item 1\nItem 2\nItem 3",type:"bullet"};case"code":return{code:"console.log('Hello');",language:"javascript"};case"query":return{queryId:""};case"datasource":return{dataSourceType:"entity",viewType:"table",viewOptions:{visibleColumns:[],sortField:null,sortOrder:"asc",filters:[]}};case"chart":return{chartType:"bar",data:JSON.stringify([{name:"Jan",value:400},{name:"Feb",value:300},{name:"Mar",value:600},{name:"Apr",value:800},{name:"May",value:500},{name:"Jun",value:700}],null,2),title:"Sample Bar Chart",xAxisKey:"name",yAxisKey:"value"};case"tabs":return{tabs:[{id:"tab-1",label:"Tab 1",content:"Content 1"},{id:"tab-2",label:"Tab 2",content:"Content 2"}]};case"accordion":return{items:[{id:"item-1",title:"Section 1",content:"Content 1"},{id:"item-2",title:"Section 2",content:"Content 2"}]};case"card":return{layout:"image-top",title:"Card Title",description:"Card description",imageUrl:"",buttonText:"Learn More",buttonLink:""};case"form-input":return{fieldName:"field_name",label:"Field Label",placeholder:"Enter value...",inputType:"text",required:!1};case"form-textarea":return{fieldName:"message",label:"Message",placeholder:"Enter your message...",rows:4,required:!1};case"form-select":return{fieldName:"select_field",label:"Select Option",placeholder:"Choose...",options:"Option 1\nOption 2\nOption 3",required:!1};case"form-checkbox":return{fieldName:"checkbox_field",label:"Select Options",options:"Option 1\nOption 2\nOption 3",type:"checkbox",required:!1};case"form-submit":return{buttonText:"Submit",buttonVariant:"default",successMessage:"Form submitted successfully!",submitAction:"custom"}}})(d),position:f.length}).select().single();return k?h.toast.error("Failed to add component"):(C([...B,j]),h.toast.success("Component added")),void G(null)}let j=B.find(a=>a.id===f);if(!j)return void G(null);await e.supabase.from("widget_components").update({row_id:j.row_id,column_index:j.column_index}).eq("id",f);let k=B.filter(a=>a.row_id===j.row_id&&a.column_index===j.column_index).sort((a,b)=>a.position-b.position);for(let a=0;a<k.length;a++)await e.supabase.from("widget_components").update({position:a}).eq("id",k[a].id);G(null)},ad=async()=>{if(!x)return;let{error:a}=await e.supabase.from("widgets").update({is_published:!x.is_published}).eq("id",x.id);a?h.toast.error("Failed to update widget"):(y({...x,is_published:!x.is_published}),h.toast.success(x.is_published?"Widget unpublished":"Widget published"))};return D?(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:"Loading..."}):(0,b.jsxs)(r.DndContext,{collisionDetection:r.pointerWithin,onDragStart:a=>{let{active:b}=a,c=b.data.current;c?.type==="new-component"&&G(c.componentType)},onDragEnd:ac,onDragOver:a=>{let{active:b,over:c}=a;if(!c)return;let d=b.id,e=b.data.current,f=c.data.current;if(e?.type==="component"&&f?.type==="droppable-column"){let a=e.component,b=f.rowId,c=f.columnIndex;(a.row_id!==b||a.column_index!==c)&&C(B.map(a=>a.id===d?{...a,row_id:b,column_index:c}:a))}},children:[(0,b.jsx)(q.SidebarProvider,{children:(0,b.jsxs)("div",{className:"min-h-screen flex w-full bg-background",children:[(0,b.jsx)(o.ComponentsSidebar,{}),(0,b.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,b.jsx)("header",{className:"border-b bg-card shadow-[var(--shadow-soft)] sticky top-0 z-50",children:(0,b.jsxs)("div",{className:"px-4 py-3 flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)(q.SidebarTrigger,{}),(0,b.jsxs)(g.Button,{variant:"outline",onClick:()=>v.push("/admin/widgets"),className:"gap-2",children:[(0,b.jsx)(i.ArrowLeft,{className:"h-4 w-4"}),"Back"]}),(0,b.jsx)("h1",{className:"text-xl font-bold",children:x?.title})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(g.Button,{variant:"ghost",size:"icon",onClick:()=>L.undo(),disabled:!L.canUndo,title:"Undo (Cmd+Z)",children:(0,b.jsx)(m.Undo,{className:"h-4 w-4"})}),(0,b.jsx)(g.Button,{variant:"ghost",size:"icon",onClick:()=>L.redo(),disabled:!L.canRedo,title:"Redo (Cmd+Shift+Z)",children:(0,b.jsx)(n.Redo,{className:"h-4 w-4"})}),(0,b.jsxs)(g.Button,{variant:"outline",onClick:()=>I(!0),className:"gap-2",children:[(0,b.jsx)(l.Monitor,{className:"h-4 w-4"}),"Preview"]}),(0,b.jsx)(g.Button,{variant:x?.is_published?"outline":"default",onClick:ad,className:"gap-2",children:x?.is_published?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(k.EyeOff,{className:"h-4 w-4"}),"Unpublish"]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(j.Eye,{className:"h-4 w-4"}),"Publish"]})})]})]})}),(0,b.jsx)("main",{className:"flex-1 overflow-auto px-4 py-8",children:(0,b.jsx)(p.GridCanvas,{rows:z,components:B,onUpdateComponent:V,onUpdateComponentStyles:T,onDeleteComponent:W,onAddRow:N,onDeleteRow:O,onUpdateRowColumns:P,onUpdateRowStyles:Q,onUpdateRowColumnWidths:R,onUpdateRowResponsiveConfig:S,onReorderRows:U,activeComponentType:F,onDuplicateComponent:Y,onPasteComponent:Z,onInsertTemplate:X,onMoveComponentToPosition:$,onAddRowAbove:_,onAddRowBelow:aa,onDuplicateRow:ab})})]})]})}),(0,b.jsx)(s.WidgetPreviewModal,{open:H,onOpenChange:I,widget:x,rows:z,components:B})]})}])}];

//# sourceMappingURL=src_views_WidgetEditor_tsx_90030ed0._.js.map